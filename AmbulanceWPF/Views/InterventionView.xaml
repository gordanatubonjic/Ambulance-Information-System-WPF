<Window x:Class="AmbulanceWPF.Views.InterventionView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:viewmodels="clr-namespace:AmbulanceWPF.ViewModels" 
        d:DataContext="{d:DesignInstance Type=viewmodels:InterventionViewModel}"
        mc:Ignorable="d"
        Title="New Intervention" Height="750" Width="900"
        WindowStartupLocation="CenterOwner"
        WindowStyle="SingleBorderWindow"
        ResizeMode="NoResize"
        ShowInTaskbar="False">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24">

            <!-- Header -->
            <Border Background="{DynamicResource PrimaryHueDarkBrush}"
                    CornerRadius="8"
                    Margin="0,0,0,24"
                    Padding="16">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="ClipboardPlus" Foreground="White" Width="32" Height="32" Margin="0,0,12,0"/>
                    <TextBlock Text="MEDICAL INTERVENTION FORM"
                               Foreground="White" FontSize="20" FontWeight="Bold"/>
                </StackPanel>
            </Border>

            <!-- Patient Info -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="Patient Information" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0"
                                 Text="{Binding PatientFirstName, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="First Name"
                                 Style="{StaticResource MaterialDesignFloatingHintTextBox}"/>
                        <TextBox Grid.Column="2"
                                 Text="{Binding PatientLastName, UpdateSourceTrigger=PropertyChanged}"
                                 materialDesign:HintAssist.Hint="Last Name"
                                 Style="{StaticResource MaterialDesignFloatingHintTextBox}"/>
                    </Grid>
                    <TextBox Text="{Binding PatientJMB, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="JMB (optional)"
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             Margin="0,12,0,0"/>
                    <TextBox Text="{Binding PatientLocation, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Location"
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             Margin="0,5,0,0"/>
                    <TextBox Text="{Binding Allergies, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Allergies"
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             Margin="0,12,0,0"
                             AcceptsReturn="True"
                             Height="50"
                             VerticalScrollBarVisibility="Auto"/>
                    <Button Content="Find or Create Patient"
                            Command="{Binding FindOrCreatePatientCommand}"
                            HorizontalAlignment="Left"
                            Margin="0,12,0,0"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Assessment -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="Assessment and Description" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>
                    <TextBox Text="{Binding InterventionDescription, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Describe findings, symptoms, vital signs..."
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             AcceptsReturn="True"
                             Height="80"
                             VerticalScrollBarVisibility="Auto"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Team -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="Medical Team" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>

                    <DataGrid ItemsSource="{Binding TeamMembers}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              Height="140"
                              Margin="0,0,0,12">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Name" Binding="{Binding Employee.FullName}" Width="*"/>
                            <DataGridTextColumn Header="Role" Binding="{Binding Role}" Width="*"/>
                            <DataGridTemplateColumn Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Remove"
                                                Command="{Binding DataContext.RemoveTeamMemberCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource MaterialDesignFlatButton}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <ComboBox Grid.Column="0"
                                  ItemsSource="{Binding AvailableEmployees}"
                                  SelectedItem="{Binding SelectedEmployee}"
                                  DisplayMemberPath="Name"
                                  materialDesign:HintAssist.Hint="Select Employee"
                                  Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                        <ComboBox Grid.Column="2"
                                  ItemsSource="{Binding Roles}"
                                  SelectedItem="{Binding SelectedRole}"
                                  materialDesign:HintAssist.Hint="Role"
                                  Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                    </Grid>

                    <Button Content="Add Member"
                            Command="{Binding AddTeamMemberCommand}"
                            HorizontalAlignment="Right"
                            Margin="0,12,0,0"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Medications -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="Administered Medications" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>

                    <DataGrid ItemsSource="{Binding AdministeredMedications}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              Height="140"
                              Margin="0,0,0,12">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Medication" Binding="{Binding Medication.Name}" Width="*"/>
                            <DataGridTextColumn Header="Dosage" Binding="{Binding Dosage}" Width="*"/>
                            <DataGridTemplateColumn Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="Remove"
                                                Command="{Binding DataContext.RemoveMedicationCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource MaterialDesignFlatButton}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Button Content="Add Medication"
                            Command="{Binding AddMedicationCommand}"
                            HorizontalAlignment="Right"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Procedures -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="Procedures Performed" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>
                    <TextBox Text="{Binding ProceduresDescription, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="Describe procedures, outcomes..."
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             AcceptsReturn="True"
                             Height="100"
                             VerticalScrollBarVisibility="Auto"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Action Buttons -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
                <Button Content="Save"
                        Command="{Binding SaveCommand}"
                        Width="160" Height="50" FontSize="16" FontWeight="Bold"/>
                <Button Content="Cancel"
                        Command="{Binding CancelCommand}"
                        Margin="12,0,0,0"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        Width="120"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</Window>