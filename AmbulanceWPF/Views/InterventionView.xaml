<Window x:Class="AmbulanceWPF.Views.InterventionView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:sys="clr-namespace:System;assembly=mscorlib"

        xmlns:viewmodels="clr-namespace:AmbulanceWPF.ViewModels" 
        d:DataContext="{d:DesignInstance Type=viewmodels:InterventionViewModel}"
        mc:Ignorable="d"
        Title="New Intervention" Height="750" Width="900"
        WindowStartupLocation="CenterOwner"
        WindowStyle="SingleBorderWindow"
        ResizeMode="NoResize"
        ShowInTaskbar="False">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24">

            <!-- Header -->
            <Border Background="{DynamicResource PrimaryHueDarkBrush}"
                    CornerRadius="8"
                    Margin="0,0,0,24"
                    Padding="16">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="ClipboardPlus" Foreground="White" Width="32" Height="32" Margin="0,0,12,0"/>
                    <TextBlock Text="MEDICAL INTERVENTION FORM"
                               Foreground="White" FontSize="20" FontWeight="Bold"/>
                </StackPanel>
            </Border>

            <!-- Patient Info -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <!-- Name Row -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0"
                     Text="{Binding PatientFirstName, UpdateSourceTrigger=PropertyChanged}"
                     materialDesign:HintAssist.Hint="{DynamicResource NameText}"
                     Style="{StaticResource MaterialDesignFloatingHintTextBox}"/>
                        <TextBox Grid.Column="2"
                     Text="{Binding PatientLastName, UpdateSourceTrigger=PropertyChanged}"
                     materialDesign:HintAssist.Hint="{DynamicResource LastNameText}"
                     Style="{StaticResource MaterialDesignFloatingHintTextBox}"/>
                    </Grid>

                    <!-- Date of Birth -->
                    <DatePicker 
                        SelectedDate="{Binding PatientDateOfBirth}"
                        materialDesign:HintAssist.Hint="{DynamicResource DateOfBirthText}"
                        Style="{StaticResource MaterialDesignFloatingHintDatePicker}"
                        Margin="0,12,0,0"
                        DisplayDateEnd="{x:Static sys:DateTime.Today}"/>

                    <!-- JMB -->
                    <TextBox Text="{Binding PatientJMB, UpdateSourceTrigger=PropertyChanged}"
                 materialDesign:HintAssist.Hint="{DynamicResource JMBText}"
                 Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                 Margin="0,12,0,0"/>

                    <!-- Location Search -->
                    <ComboBox 
            ItemsSource="{Binding AvailableLocations}"
            SelectedItem="{Binding SelectedLocation}"
            Text="{Binding PatientLocationName, UpdateSourceTrigger=PropertyChanged}"
            materialDesign:HintAssist.Hint="{DynamicResource LocationText}"
            Style="{StaticResource MaterialDesignFloatingHintComboBox}"
            Margin="0,12,0,0"
            IsEditable="True"
            StaysOpenOnEdit="True">
                        <ComboBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <VirtualizingStackPanel />
                            </ItemsPanelTemplate>
                        </ComboBox.ItemsPanel>
                    </ComboBox>

                    <!-- Allergies -->
                    <TextBox Text="{Binding Allergies, UpdateSourceTrigger=PropertyChanged}"
                 materialDesign:HintAssist.Hint="{DynamicResource AllergiesText}"
                 Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                 Margin="0,12,0,0"
                 AcceptsReturn="True"
                 Height="50"
                 VerticalScrollBarVisibility="Auto"
                 TextWrapping="Wrap"/>
                    <Button Content="{DynamicResource FindorCreatePatientText}"
                    Command="{Binding FindOrCreatePatientCommand}"
                    HorizontalAlignment="Left"
                    Margin="0,12,0,0"/>
                </StackPanel>
            </materialDesign:Card>
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="{DynamicResource AssessmentDescriptionText}" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>
                    <TextBox Text="{Binding InterventionDescription, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="{DynamicResource SelfAssesment}"
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             AcceptsReturn="True"
                             Height="80"
                             VerticalScrollBarVisibility="Auto"/>
                </StackPanel>
            </materialDesign:Card>

            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="{DynamicResource MedicalTeamText}" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>

                    <DataGrid ItemsSource="{Binding TeamMembers}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              Height="140"
                              Margin="0,0,0,12">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{DynamicResource NameText}" Binding="{Binding Employee.FullName}" Width="*"/>
                            <DataGridTextColumn Header="{DynamicResource RoleText}" Binding="{Binding Role}" Width="*"/>
                            <DataGridTemplateColumn Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="{DynamicResource RemoveText}"
                                                Command="{Binding DataContext.RemoveTeamMemberCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource MaterialDesignFlatButton}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <ComboBox Grid.Column="0"
                                  ItemsSource="{Binding AvailableEmployees}"
                                  SelectedItem="{Binding SelectedEmployee}"
                                  DisplayMemberPath="Name"
                                  materialDesign:HintAssist.Hint="{DynamicResource SelectEmployeeText}"
                                  Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                        <ComboBox Grid.Column="2"
                                  ItemsSource="{Binding Roles}"
                                  SelectedItem="{Binding SelectedRole}"
                                  materialDesign:HintAssist.Hint="{DynamicResource RoleText}"
                                  Style="{StaticResource MaterialDesignFloatingHintComboBox}"/>
                    </Grid>

                    <Button Content="{DynamicResource SelectEmployeeText}"
                            Command="{Binding AddTeamMemberCommand}"
                            HorizontalAlignment="Right"
                            Margin="0,12,0,0"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Medications -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="{DynamicResource AdministeredMedicationsText}" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>

                    <DataGrid ItemsSource="{Binding AdministeredMedications}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              Height="140"
                              Margin="0,0,0,12">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{DynamicResource MedicationText}" Binding="{Binding Medication.Name}" Width="*"/>
                            <DataGridTextColumn Header="{DynamicResource DosageText}" Binding="{Binding Dosage}" Width="*"/>
                            <DataGridTemplateColumn Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="{DynamicResource RemoveText}"
                                                Command="{Binding DataContext.RemoveMedicationCommand, RelativeSource={RelativeSource AncestorType=Window}}"
                                                CommandParameter="{Binding}"
                                                Style="{StaticResource MaterialDesignFlatButton}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>

                    <Button Content="{DynamicResource AddMedicationText}"
                            Command="{Binding AddMedicationCommand}"
                            HorizontalAlignment="Right"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Procedures -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="{DynamicResource ProceduresText}" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>
                    <TextBox Text="{Binding ProceduresDescription, UpdateSourceTrigger=PropertyChanged}"
                             materialDesign:HintAssist.Hint="{DynamicResource ProceduresDescriptionText}"
                             Style="{StaticResource MaterialDesignFloatingHintTextBox}"
                             AcceptsReturn="True"
                             Height="100"
                             VerticalScrollBarVisibility="Auto"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Action Buttons -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
                <Button Content="{DynamicResource SaveText}"
                        Command="{Binding SaveCommand}"
                        Width="160" Height="50" FontSize="16" FontWeight="Bold"/>
                <Button Content="{DynamicResource CancelText}"
                        Command="{Binding CancelCommand}"
                        Margin="12,0,0,0"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        Width="120"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</Window>