<Window x:Class="AmbulanceWPF.Views.ExaminationView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
        xmlns:viewmodels="clr-namespace:AmbulanceWPF.ViewModels"    
        xmlns:sys="clr-namespace:System;assembly=mscorlib"

        Title="Examination View" Height="2000"   
         Width="1000"
        WindowStartupLocation="CenterOwner">

    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24">

            <!-- Header -->
            <Border Background="{DynamicResource PrimaryHueDarkBrush}" CornerRadius="8" Margin="0,0,0,24" Padding="16">
                <StackPanel Orientation="Horizontal">
                    <materialDesign:PackIcon Kind="Stethoscope" Foreground="White" Width="32" Height="32" Margin="0,0,12,0"/>
                    <TextBlock Text="PATIENT EXAMINATION FORM" Foreground="White" FontSize="20" FontWeight="Bold"/>
                </StackPanel>
            </Border>

            <!-- Patient Info -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <!-- Name Row -->
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="12"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <TextBox Grid.Column="0"
          Text="{Binding PatientFirstName, UpdateSourceTrigger=PropertyChanged}"
          materialDesign:HintAssist.Hint="{DynamicResource FirstNameText}"
          Style="{StaticResource MaterialDesignFloatingHintTextBox}"/>
                        <TextBox Grid.Column="2"
          Text="{Binding PatientLastName, UpdateSourceTrigger=PropertyChanged}"
          materialDesign:HintAssist.Hint="{DynamicResource LastNameText}"
          Style="{StaticResource MaterialDesignFloatingHintTextBox}"/>
                    </Grid>

                    <!-- Date of Birth -->

                    <TextBox Text="{Binding PatientDateOfBirth, UpdateSourceTrigger=PropertyChanged}"
                        materialDesign:HintAssist.Hint="{DynamicResource DateOfBirthText}"
                        Style="{StaticResource MaterialDesignFloatingHintTextBox}"
Margin="0,12,0,0"/>

                    <!-- JMB -->
                    <TextBox Text="{Binding PatientJMB, UpdateSourceTrigger=PropertyChanged}"
      materialDesign:HintAssist.Hint="{DynamicResource JMBText}"
      Style="{StaticResource MaterialDesignFloatingHintTextBox}"
      Margin="0,12,0,0"/>

                    <!-- Location Search -->
                    <ComboBox 
 ItemsSource="{Binding AvailableLocations}"
 SelectedItem="{Binding SelectedLocation}"
 Text="{Binding PatientLocationName, UpdateSourceTrigger=PropertyChanged}"
 materialDesign:HintAssist.Hint="{DynamicResource LocationText}"
 Style="{StaticResource MaterialDesignFloatingHintComboBox}"
 Margin="0,12,0,0"
 IsEditable="True"
 StaysOpenOnEdit="True">
                        <ComboBox.ItemsPanel>
                            <ItemsPanelTemplate>
                                <VirtualizingStackPanel />
                            </ItemsPanelTemplate>
                        </ComboBox.ItemsPanel>
                    </ComboBox>

                    <!-- Allergies -->
                    <TextBox Text="{Binding Allergies, UpdateSourceTrigger=PropertyChanged}"
      materialDesign:HintAssist.Hint="{DynamicResource AllergiesText}"
      Style="{StaticResource MaterialDesignFloatingHintTextBox}"
      Margin="0,12,0,0"
      AcceptsReturn="True"
      Height="50"
      VerticalScrollBarVisibility="Auto"
      TextWrapping="Wrap"/>
                    <Button Content="{DynamicResource FindorCreatePatientText}"
         Command="{Binding FindOrCreatePatientCommand}"
         HorizontalAlignment="Left"
         Margin="0,12,0,0"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Examination Details -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="{DynamicResource NewExamText}" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>
                    <DatePicker SelectedDate="{Binding Examination.ExaminationDate}" materialDesign:HintAssist.Hint="{DynamicResource DateText}" Style="{StaticResource MaterialDesignFloatingHintDatePicker}"/>
                    <TextBox Text="{Binding Examination.ExaminationDescription, UpdateSourceTrigger=PropertyChanged}" materialDesign:HintAssist.Hint="{DynamicResource DescriptionText}" Style="{StaticResource MaterialDesignFloatingHintTextBox}" AcceptsReturn="True" Height="100" VerticalScrollBarVisibility="Auto" Margin="0,12,0,0"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Diagnosis -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="{DynamicResource DiagnosisText}" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>
                    <DataGrid ItemsSource="{Binding Diagnosis}" AutoGenerateColumns="False" CanUserAddRows="False" Height="150" Margin="0,0,0,12">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{DynamicResource DiseaseText}" Binding="{Binding Disease.DiseaseCode}" Width="*" IsReadOnly="True"/>
                            <DataGridTextColumn Header="{DynamicResource DoctorOpinionText}" Binding="{Binding DoctorOpinion}" Width="*" IsReadOnly="True"/>
                            <DataGridTextColumn Header="{DynamicResource DateText}" Binding="{Binding Date}" Width="*" IsReadOnly="True" />
                            <DataGridTemplateColumn Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="{DynamicResource RemoveText}" Command="{Binding DataContext.RemoveDiagnosisCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Style="{StaticResource MaterialDesignFlatButton}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    <Button Content="{DynamicResource AddDiagnosisText}" Command="{Binding AddDiagnosisCommand}" HorizontalAlignment="Right"/>
                </StackPanel>
            </materialDesign:Card>

            <!-- Referrals -->
            <materialDesign:Card Margin="0,0,0,20" Padding="16">
                <StackPanel>
                    <TextBlock Text="{DynamicResource ReferalText}" Style="{StaticResource MaterialDesignHeadline6TextBlock}" Margin="0,0,0,12"/>
                    <DataGrid ItemsSource="{Binding Referrals}" AutoGenerateColumns="False" CanUserAddRows="False" Height="150" Margin="0,0,0,12">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="{DynamicResource DiseaseText}" Binding="{Binding Disease.DiseaseName}" Width="*"/>
                            <DataGridTextColumn Header="{DynamicResource SpecialistsText}" Binding="{Binding Specialists}" Width="*"/>
                            <DataGridTextColumn Header="{DynamicResource DateText}" Binding="{Binding Date}" Width="*"/>
                            <DataGridTemplateColumn Width="Auto">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <Button Content="{DynamicResource RemoveText}" Command="{Binding DataContext.RemoveReferralCommand, RelativeSource={RelativeSource AncestorType=UserControl}}" CommandParameter="{Binding}" Style="{StaticResource MaterialDesignFlatButton}"/>
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                        </DataGrid.Columns>
                    </DataGrid>
                    <Button Content="{DynamicResource AddReferralText}" Command="{Binding AddReferralCommand}" HorizontalAlignment="Right"/>
                </StackPanel>
            </materialDesign:Card>

            
            <!-- Action Buttons -->
            <StackPanel Orientation="Horizontal" HorizontalAlignment="Center" Margin="0,20,0,0">
                <Button Content="{DynamicResource SaveText}" Command="{Binding SaveCommand}" Width="160" Height="50" FontSize="16" FontWeight="Bold"/>
                <Button Content="{DynamicResource CancelText}" Command="{Binding CancelCommand}" Margin="12,0,0,0" Style="{StaticResource MaterialDesignFlatButton}" Width="120"/>
            </StackPanel>

        </StackPanel>
    </ScrollViewer>
</Window>