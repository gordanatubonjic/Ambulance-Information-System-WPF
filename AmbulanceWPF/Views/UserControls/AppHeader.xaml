<UserControl x:Class="AmbulanceWPF.Views.UserControls.AppHeader"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes">
    <UserControl.Resources>
        <Style x:Key="ProfileDropdownPopup" TargetType="Popup">
            <Setter Property="AllowsTransparency" Value="True"/>
            <Setter Property="StaysOpen" Value="False"/>
            <Setter Property="PopupAnimation" Value="Fade"/>
        </Style>
        <Style x:Key="ProfileMenuItem" TargetType="Button" BasedOn="{StaticResource MaterialDesignFlatButton}">
            <Setter Property="HorizontalAlignment" Value="Stretch"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="16,12"/>
            <Setter Property="Height" Value="48"/>
            <Setter Property="FontSize" Value="14"/>
        </Style>
    </UserControl.Resources>
    <Border Background="{DynamicResource MaterialDesignPaper}"
            BorderBrush="{DynamicResource MaterialDesignDivider}"
            BorderThickness="0,0,0,1">
        <Border.Effect>
            <DropShadowEffect ShadowDepth="2" Direction="270" Color="Black" Opacity="0.2" BlurRadius="4"/>
        </Border.Effect>
        <Grid Height="64" Margin="16,0">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="Auto"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>
            <Button Grid.Column="0"
        Style="{StaticResource MaterialDesignIconButton}"
        Command="{Binding HomeCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
        ToolTip="Home"
        Width="40" Height="40"
        VerticalAlignment="Center">
                <materialDesign:PackIcon Kind="Home" Width="26" Height="26" Foreground="{DynamicResource MaterialDesignBody}"/>
            </Button>
            <StackPanel Grid.Column="1"
                        Orientation="Horizontal"
                        VerticalAlignment="Center"
                        HorizontalAlignment="Center">
                <materialDesign:PackIcon Kind="Ambulance" Width="32" Height="32" Foreground="{DynamicResource MaterialDesignBody}" VerticalAlignment="Center"/>
                <TextBlock Text="{DynamicResource AppHeaderText}" FontSize="20" FontWeight="Medium" Foreground="{DynamicResource MaterialDesignBody}" VerticalAlignment="Center" Margin="12,0,0,0"/>
            </StackPanel>
            <Grid Grid.Column="2" VerticalAlignment="Center">
                <Button x:Name="ProfileButton"
                        Style="{StaticResource MaterialDesignFlatButton}"
                        Padding="8"
                        Height="48"
                        Click="ProfileButton_Click"
                        ToolTip="Profile Menu">
                    <StackPanel Orientation="Horizontal">
                        <Border Background="{DynamicResource MaterialDesignDivider}" CornerRadius="20" Width="32" Height="32" Margin="0,0,8,0">
                            <TextBlock Text="{Binding DoctorInitials}" FontSize="14" FontWeight="Medium" Foreground="{DynamicResource MaterialDesignBody}" HorizontalAlignment="Center" VerticalAlignment="Center"/>
                        </Border>
                        <TextBlock Text="{Binding DoctorName}" FontSize="14" FontWeight="Medium" Foreground="{DynamicResource MaterialDesignBody}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                        <materialDesign:PackIcon Kind="ChevronDown" Width="16" Height="16" Foreground="{DynamicResource MaterialDesignBodyLight}" VerticalAlignment="Center" x:Name="DropdownArrow">
                            <materialDesign:PackIcon.RenderTransform>
                                <RotateTransform x:Name="ArrowRotateTransform" CenterX="8" CenterY="8"/>
                            </materialDesign:PackIcon.RenderTransform>
                        </materialDesign:PackIcon>
                    </StackPanel>
                </Button>
                <Popup x:Name="ProfilePopup"
                       Style="{StaticResource ProfileDropdownPopup}"
                       Placement="Bottom"
                       PlacementTarget="{Binding ElementName=ProfileButton}"
                       HorizontalOffset="-20"
                       VerticalOffset="8"
                       Opened="ProfilePopup_Opened"
                       Closed="ProfilePopup_Closed">
                    <Border Background="{DynamicResource MaterialDesignPaper}" CornerRadius="4" BorderBrush="{DynamicResource MaterialDesignDivider}" BorderThickness="1" Width="200">
                        <Border.Effect>
                            <DropShadowEffect ShadowDepth="4" Direction="315" Color="Black" Opacity="0.3" BlurRadius="8"/>
                        </Border.Effect>
                        <StackPanel>
                            <Border Background="{DynamicResource MaterialDesignToolBarBackground}" Padding="16,12" CornerRadius="4,4,0,0">
                                <StackPanel>
                                    <TextBlock Text="{Binding DoctorName}" FontSize="16" FontWeight="Medium" Foreground="{DynamicResource MaterialDesignBody}"/>
                                    <TextBlock Text="{Binding DoctorEmail}" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}" Margin="0,2,0,0"/>
                                    <TextBlock Text="{Binding DoctorRole}" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}" Margin="0,2,0,0"/>
                                </StackPanel>
                            </Border>
                            <Rectangle Height="1" Fill="{DynamicResource MaterialDesignDivider}"/>
                            <Button Style="{StaticResource ProfileMenuItem}" 
                                 Command="{Binding ViewProfileCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                                 Click="ClosePopup_Click">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Account" 
                                                           Width="20" Height="20"
                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                           VerticalAlignment="Center"/>
                                    <TextBlock Text="{DynamicResource ViewProfileText}"
                                             Margin="12,0,0,0"
                                             VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource ProfileMenuItem}" 
                            Command="{Binding DataContext.HeaderThemeCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            Click="ClosePopup_Click">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="ThemeOutline"  
                                                           Width="20" Height="20"
                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                           VerticalAlignment="Center"/>
                                    <TextBlock Text="{DynamicResource ChangeThemeText}" 
                                             Margin="12,0,0,0"
                                             VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                            <Button Style="{StaticResource ProfileMenuItem}" 
                            Command="{Binding DataContext.HeaderLanguageCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            Click="ClosePopup_Click">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Language"  
                                                           Width="20" Height="20"
                                                           Foreground="{DynamicResource MaterialDesignBodyLight}"
                                                           VerticalAlignment="Center"/>
                                    <TextBlock Text="{Binding SelectedLanguage}" 
                                             Margin="12,0,0,0"
                                             VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>

                            <Button Style="{StaticResource ProfileMenuItem}" 
                            Command="{Binding LogoutCommand, RelativeSource={RelativeSource AncestorType=UserControl}}"
                            Click="ClosePopup_Click">
                                <StackPanel Orientation="Horizontal">
                                    <materialDesign:PackIcon Kind="Logout" 
                           Width="20" Height="20"
                           Foreground="#D32F2F"
                           VerticalAlignment="Center"/>
                                    <TextBlock Text="{DynamicResource LogoutText}" 
             Margin="12,0,0,0"
             Foreground="#D32F2F"
             VerticalAlignment="Center"/>
                                </StackPanel>
                            </Button>
                        </StackPanel>
                    </Border>
                </Popup>
            </Grid>
        </Grid>
    </Border>
</UserControl>